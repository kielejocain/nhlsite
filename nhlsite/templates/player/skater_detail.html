{% extends "base.html" %}

{% load mathfilters %}

{% load static %}

{% block title %}{{ skater }} Statistics - HockeyML{% endblock %}

{% block content %}

<h1>{{ skater }}</h1>

<p>DOB: {{ skater.birthday }}</p>
{% if skater.draft_position %}
<p>Drafted: {{ skater.draft_year }}, #{{ skater.draft_position }} Overall</p>
{% else %}
<p>Undrafted</p>
{% endif %}

<div id="chart"></div>

<style>

.bullet { font: 10px sans-serif; }
.bullet .marker { stroke: #000; stroke-width: 2px; }
.bullet .tick line { stroke: #666; stroke-width: .5px; }
.bullet .range.s0 { fill: #ddd; }
.bullet .range.s1 { fill: #99f; }
.bullet .range.s2 { fill: #9f9; }
.bullet .range.s3 { fill: #fa9; }
.bullet .measure.s0 { fill: #00f; }
.bullet .measure.s1 { fill: #0f0; }
.bullet .measure.s2 { fill: #f60; }
.bullet .title { font-size: 14px; font-weight: bold; }
.bullet .subtitle { fill: #999; }

</style>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="{% static 'js/bullet.js' %}"></script>
<script>

var margin = {top: 5, right: 40, bottom: 20, left: 120},
    width = 960 - margin.left - margin.right,
    height = 50 - margin.top - margin.bottom;

var chart = d3.bullet()
    .width(width)
    .height(height);

d3.json("{% url 'player_graph' %}?pk={{ skater.nhl_num }}", function(error, data) {
  var svg = d3.select("#chart").selectAll("svg")
      .data(data)
    .enter().append("svg")
      .attr("class", "bullet")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      .call(chart);

  var title = svg.append("g")
      .style("text-anchor", "end")
      .attr("transform", "translate(-6," + height / 2 + ")");

  title.append("text")
      .attr("class", "title")
      .text(function(d) { return d.title; });

  title.append("text")
      .attr("class", "subtitle")
      .attr("dy", "1em")
      .text(function(d) { return d.subtitle; });
});

</script>

<h2>Base Statistics</h2>
<table class="table table-hover">
    <tr>
        <th>Season</th>
        <th title="Games Played">GP</th>
        <th title="Goals">G</th>
        <th title="Assists">A</th>
        <th title="Points">P</th>
        <th title="Plus/Minus">+/-</th>
        <th title="Penalties (In Minutes)">PIM</th>
        <th title="Shots">S</th>
        <th title="Shot Percentage">S%</th>
    </tr>
    {% for season in skaterstats %}
    <tr>
        <td>{{ season.season }}</td>
        <td>{{ season.games_played }}</td>
        <td>{{ season.goals }}</td>
        <td>{{ season.assists }}</td>
        <td>{{ season.points }}</td>
        <td>{{ season.plus_minus }}</td>
        <td>{{ season.penalty_minutes }}</td>
        <td>{{ season.shots }}</td>
        <td>{{ season.shot_pct }}</td>
    </tr>
    {% endfor %}
    {% if skaterpredictions %}
    <tr class="danger">
        <td>2015 (Predicted)</td>
        <td>{{ skaterpredictions.games_played|floatformat:"0" }}</td>
        <td>{{ skaterpredictions.goals|floatformat:"0" }}</td>
        <td>{{ skaterpredictions.assists|floatformat:"0" }}</td>
        <td>{{ skaterpredictions.points|floatformat:"0" }}</td>
        <td>{{ skaterpredictions.plus_minus|floatformat:"0" }}</td>
        <td>{{ skaterpredictions.penalty_minutes|floatformat:"0" }}</td>
        <td>{{ skaterpredictions.shots|floatformat:"0" }}</td>
        <td>{{ skaterpredictions.shot_pct|floatformat:"1" }}</td>
    </tr>
    {% endif %}
</table>

<h2>Situational Statistics</h2>
<table class="table table-hover">
    <tr>
        <th></th>
        <th colspan="3">Time On Ice Per Game</th>
        <th colspan="2">Goals</th>
        <th colspan="2">Points</th>
    </tr>
    <tr>
        <th>Season</th>
        <th>Total</th>
        <th title="Power Play">PP</th>
        <th title="Short-handed">SH</th>
        <th title="Power Play">PP</th>
        <th title="Short-handed">SH</th>
        <th title="Power Play">PP</th>
        <th title="Short-handed">SH</th>
    </tr>
    {% for season in skaterstats %}
    <tr>
        <td>{{ season.season }}</td>
        <td>{{ season.toi|intdiv:60 }}:{% if season.toi|mod:60 < 10 %}0{% endif %}{{ season.toi|mod:60 }}</td>
        <td>{{ season.pp_toi|intdiv:60 }}:{% if season.pp_toi|mod:60 < 10 %}0{% endif %}{{ season.pp_toi|mod:60 }}</td>
        <td>{{ season.sh_toi|intdiv:60 }}:{% if season.sh_toi|mod:60 < 10 %}0{% endif %}{{ season.sh_toi|mod:60 }}</td>
        <td>{{ season.pp_goals }}</td>
        <td>{{ season.sh_goals }}</td>
        <td>{{ season.pp_points }}</td>
        <td>{{ season.sh_points }}</td>
    </tr>
    {% endfor %}
</table>

{% endblock %}